import cocotb
from cocotb.clock import Clock
from cocotb.triggers import ClockCycles, Timer
import random


# async def reset(dut):
#     dut.BTN_N = 0

#     await ClockCycles(dut.CLK, 5)
#     dut.BTN_N = 1


@cocotb.test()
async def test_top(dut):
    dut.clk = 0
    await Timer(83.3, units="ns")
    clock = Clock(dut.clk, 83.3, units="ns")
    cocotb.start_soon(clock.start())
    regfile = dut.regfile.RegisterFile
    x1 = regfile[1]
    x2 = regfile[2]
    dmem = [
        dut.memory.dmem0.memory.value,
        dut.memory.dmem1.memory.value,
        dut.memory.dmem2.memory.value,
        dut.memory.dmem3.memory.value,
    ]
    pc = dut.pc
    # await reset(dut)
    await ClockCycles(dut.clk, 350)
    # print(dmem)
    # print(x1.value)
    # print(x2.value)
    # print(regfile.value)
    for i in regfile.value:
        print(hex(i))
    assert (
        str(regfile.value)
        == "[00000000000000000000000000000000, 11111110110111001011101010011000, 00001111111011011100101110101001, 11111111111011011100101110101001, 00000000000100100011010001010110, 00000000000000000000000000000010, 00000000000100100011010001011000, 00000000000000000000000000000010, 00000000010010001101000101011000, 00000000010010001101000101011111, 00010010001101000110000000101000, 00000000000000000000000000000001, 00000000000000000000000000000000, 00000000000000000001000000111000, 00000000000000000001000001100000, 00000000000000000000000000000000, 00000000000000000001000001001000, 00000000000000000000000011000000, 11000000110000001100000011000000, 00000000000000000000000000010001, 11111111111111111100000011000000, 00000000000000001100000011000000, 11111111111111111111111111000000, 00000000000000000000000011000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000, 00000000000000000000000000000000]"
    )
    # print(dmem)
    print(pc.value)
    # print(int(x2.value) - int(pc.value))
    # print(int(pc.value) - int(x1.value))
    # print(dmem.value)
    # await Timer(20, units="us")
